# Fluxo Certo - Script de Execu√ß√£o

```                                                                                

      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
      ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó
      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë      ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë
      ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë      ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë
      ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù      ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
      ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

```

Este reposit√≥rio faz parte do projeto **Fluxo Certo** e cont√©m um Shell Script para facilitar a execu√ß√£o e inicializa√ß√£o do ambiente do projeto de forma automatizada.

## üìú Sobre o Script

O objetivo deste script √©:

- Automatizar o processo de inicializa√ß√£o do projeto Fluxo Certo
- Garantir que todas as depend√™ncias estejam instaladas corretamente
- Rodar os servi√ßos necess√°rios (como servidores, banco de dados, etc.)
- Fornecer uma maneira r√°pida e padronizada de subir o ambiente local

## üöÄ Como usar

### Pr√©-requisitos

Antes de executar o script, certifique-se de que voc√™ possui:

- M√°quina AWS EC2
- Ambiente Linux
- Permiss√µes para executar scripts `.sh`
- Inst√¢ncia com boa capacidade de armazenamento.

---

## Passo a passo - Processo de utiliza√ß√£o

### 1 - Criando o reposit√≥rio:

**1.1** Clone este reposit√≥rio:
   ```bash
   git clone https://github.com/vitorluzz/projeto_shell_fluxo_certo.git
   cd projeto_shell_fluxo_certo
   ```
   
---
### 2 - Fun√ß√£o/Role na EC2

**2.1** Na AWS, nas sele√ß√µes das inst√¢ncias, selecione a sua inst√¢cia e v√° em modificar a fun√ß√£o do IAM:

![alt text](./assets/step1.png)

**2.2** Selecione a op√ß√£o 'LabInstanceProfile':

![alt text](./assets/step2.png)

---

### 3 - Cria√ß√£o do bucket S3

**3.1** Crie um bucket S3 com o nome 'dl-fluxo-certo'
> **OBS: O bucket precisa ter exatamente esse nome!!!**

![alt text](./assets/step.png)

> As configura√ß√µes do bucket s√£o as padr√µes.

**3.2** Adicionando ao S3 os dados brutos:
> Os dados para adicionar est√£o no diret√≥rio 'arquivos' deste reposit√≥rio.

Basta selecionar o S3 e clicar em 'Carregar', e ent√£o arrastar os arquivos para adiciona-los, depois, clique em 'Carregar':
![alt text](./assets/s3.png)

> Ap√≥s isso, temos as bases de dados brutos carregadas em nosso Data Lake.

---

### 4 - Configurando o grupo de seguran√ßa da inst√¢ncia:

Vamos definir algumas novas regras de entrada, para a aplica√ß√£o rodar corretamente:

![alt text](./assets/image-1.png)

**Configura√ß√£o de Rede e Servi√ßos da Aplica√ß√£o**

Para garantir o funcionamento correto e o acesso adequado √† nossa aplica√ß√£o, definimos algumas regras e configura√ß√µes de portas:

- **Porta 80 (HTTP)**  
  Essa porta est√° configurada para o nosso DNS personalizado utilizando o servi√ßo DuckDNS. √â por meio dela que as requisi√ß√µes HTTP externas s√£o roteadas para nossa aplica√ß√£o.

- **SSH (porta padr√£o 22)**  
  O acesso via SSH est√° habilitado para permitir que qualquer dispositivo autorizado possa se conectar remotamente ao servidor, facilitando a administra√ß√£o e manuten√ß√£o da aplica√ß√£o.

- **MySQL (porta padr√£o 3306)**  
  O servi√ßo de banco de dados MySQL est√° habilitado e configurado para aceitar conex√µes externas, garantindo que a aplica√ß√£o tenha acesso ao banco para leitura e escrita dos dados.

- **Porta 8080**  
  Esta √© a porta onde a nossa aplica√ß√£o Node.js est√° rodando, recebendo as requisi√ß√µes HTTP internas que eventualmente s√£o expostas externamente pela porta 80 via o DNS DuckDNS.

---

### 5 - Execu√ß√£o dos Scripts

Vamos dar permiss√£o de execu√ß√£o para os dois scripts.

**5.1** Dando permiss√£o de execu√ß√£o aos scripts:
```bash
chmod +x ambiente.sh
chmod +x etl.sh
```

**5.2** Execute o script para cria√ß√£o do ambiente:
```bash
./ambiente.sh
```
> Pronto, temos o java, docker, docker-compose e nossos containers contendo a aplica√ß√£o node e o banco de dados mysql.


**5.3** Execute o script para execu√ß√£o do ETL:
```bash
./etl.sh
```

---

### 6 - Configurando o CRON (Agendador de Tarefas)

>Vamos agendar a execu√ß√£o do arquivo JAR usando o CRON, garantindo que ele seja executado periodicamente para manter a integridade dos dados.

**6.3** Acessando o crontab:
```bash
crontab ‚Äìe
```

**6.3** Selecione o editor nano: (OP√á√ÉO 1)
![alt text](./assets/image-cron.png)


**6.3** Adicionando o comando para executar o JAR dentro do container de 1 em 1 semana:
```
0 0 * * 0 docker exec container-java bash -c "source ~/.bashrc && java -jar /home/extracaoDados.jar"
```

**6.3** Salve as altera√ß√µes:

**CTRL + O , ENTER, CTRL + X**

---

## Iniciando ambiente j√° criado (Inicializado a partir de uma AMI)

Caso voc√™ j√° tenha o ambiente criado, utilize o script de inicializa√ß√£o do ambiente:
```bash
chmod +x start-env.sh
./start-env.sh
```

#### **ATEN√á√ÉO!!**

Utilize o usu√°rio ubuntu para se conectar √† inst√¢ncia, exemplo:

```bash
ssh -i "chave_projeto.pem" ubuntu@ec2-54-145-17-115.compute-1.amazonaws.com
```



